<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="album.css">
    <title>Soundsnap</title>
</head>
<body onload="album_main()">
    <header>
        <a href="/" class="logo">
            <img src="logo_soundsnap_claro.png" alt="" class="logo">
        </a>
        <form action="" method="get" id="pesquisa">
            <input type="text" name="search" id="pesq" placeholder="O quê você quer ouvir hoje?"> 
            <button type="submit">
                <img src="play_bege_soundsnap.png" alt="">
            </button>
        </form>
        <a href="cadastro.html" class="form">
            <img src="user.png" alt="">
        </a>
    </header>
    <main>
        <div class="container">
            <div id="artista"></div>
            <div id="album">
                
            </div>
        </div>
    </main>
    <script src="acess.js"></script>
    <script>
        
async function album(token, id) {
    const result = fetch("https://api.spotify.com/v1/albums/" + id, {
        headers: {'Authorization': "Bearer " + token.access_token}
    }).then(data => {
        return data.json()
    }).then(response =>{
        return response
    })
    let response = await result
    artista(token, response.artists[0].id, response) 
    console.log(response)
    return response
}



async function artista(token, id, album) {
    const result = fetch("https://api.spotify.com/v1/artists/" + id, {
        headers: {'Authorization': "Bearer " + token.access_token}
    }).then(data => {
        return data.json()
    }).then(response =>{
        return response
    })
    let response = await result
    console.log(response)
    await displayer(response, album)
    return response
}

async function displayer(artista, album) {
    let a = document.getElementById("artista")
    let b = document.getElementById("album")

    a.innerHTML += 
    `
        <img src=${artista.images[1].url} alt="">
        <div class="infos">
            <h1>${artista.name}</h1>
            <p>${artista.followers.total} Seguidores</p>
            <p id="generos">Principais generos: </p>
            <p>Nota de popularidade: ${artista.popularity}</p>
        </div>
    `
    for (let i = 0; i < artista.genres.length; i++) {
        if (i >= artista.genres.length-1) {
            document.getElementById("generos").innerHTML += artista.genres[i]
        } else {
            document.getElementById("generos").innerHTML += artista.genres[i] + ", &nbsp"
        }
    }


    b.innerHTML += 
    `
        <h1>${album.name}</h1>
        <img src=${album.images[0].url} alt="">
        <div class="album_infos">
            <div class="infos artistas" >Artistas: <p id="artistas"></div>                       
            <div class="infos">Musicas: <p>${album.total_tracks}</p></div>
            <div class="infos">Tipo: <p>${album.album_type}</p></div>
            <div class="infos">Laçamento(A/M/D): <p>${album.release_date.replace(/-/g, "/")}</p></div>
        </div>
    `
  
    for (let x = 0; x < album.artists.length; x++) {
        if (x >= album.artists.length-1) {
            document.getElementById("artistas").innerText += album.artists[x]
        } else {
            document.getElementById("artistas").innerHTML += album.artists[x] + ", &nbsp"
        }
    }
}

    </script>
</body>
</html>